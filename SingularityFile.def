Bootstrap: docker
From: mfisherman/openmpi

%labels
    Author danielepiano

%post
    # Prepare folders to be used
    mkdir -p ./input ./bin

%files
    # Copy executable in /bin directory
    ./build/main ./bin/matrix-multiplication

    # Copy matrix samples to run the executable with
    matrixA.txt /input/matrixA.txt
    matrixB.txt /input/matrixB.txt

%runscript
    echo ">> Container started. . ."
    ./bin/matrix-multiplication

%test
    # Check if required files exist
    echo ">> Verifying required files exist..."
    if [[ ! -f /bin/matrix-multiplication ]]; then
        echo ">> !! Missing: /bin/matrix-multiplication"
    fi
    if [[ ! -f /input/matrixA.txt ]]; then
        echo ">> !! Missing: /input/matrixA.txt"
    fi
    if [[ ! -f /input/matrixB.txt ]]; then
        echo ">> !! Missing: /input/matrixB.txt"
    fi
    echo ">> Check completed."

%help
    This is a container hosting a mini-app to perform matrix multiplication, exploiting parallelism via MPI.
    The status quo is: the two matrices are hardcoded, only 2 processes may run concurrently.