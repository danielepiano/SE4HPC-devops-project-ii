Bootstrap: docker
From: mfisherman/openmpi

%labels
    Author danielepiano

%post
    # Prepare folders to be used
    mkdir -p /input /bin

%files
    # Copy executable in /bin directory
    /build/main /bin/mx-multiplication

    # Copy matrix samples to run the executable with
    matrixA.txt /input/matrixA.txt
    matrixB.txt /input/matrixB.txt

%runscript
    echo ">> Container started..."
    mpiexec -np 2 /bin/mx-multiplication

%test
    # Check if required files exist
    echo ">> Verifying required files exist..."
    if [[ ! -x /bin/mx-multiplication ]]; then
        echo ">> !! Missing: /bin/mx-multiplication"
    fi
    if [[ ! -f /input/matrixA.txt ]]; then
        echo ">> !! Missing: /input/matrixA.txt"
    fi
    if [[ ! -f /input/matrixB.txt ]]; then
        echo ">> !! Missing: /input/matrixB.txt"
    fi
    echo ">> Check completed."

%help
    This is a container hosting a mini-app to perform matrix multiplication, exploiting parallelism via MPI.
    The status quo is: the two matrices are hardcoded, only 2 processes may run concurrently.