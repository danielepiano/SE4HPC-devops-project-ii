Bootstrap: docker
From: mfisherman/openmpi:4.0.2

%labels
    Author danielepiano


%environment



%files
    # Copy executable and matrix samples to run the executable with
    ./build/main /apps/mx-multiplication/
    ./matrixA.txt /apps/mx-multiplication/
    ./matrixB.txt /apps/mx-multiplication/


%post



%runscript
    mpirun -n 2 --wdir /apps/mx-multiplication main


%test
    # Check if required files exist
    echo ">> Verifying required files exist..."
    if [ ! -x /apps/mx-multiplication/main ]; then
        echo ">> !! Missing: main"
    fi
    if [ ! -f /apps/mx-multiplication/matrixA.txt ]; then
        echo ">> !! Missing: matrixA.txt"
    fi
    if [ ! -f /apps/mx-multiplication/matrixB.txt ]; then
        echo ">> !! Missing: matrixB.txt"
    fi
    echo ">> Check completed."


%help
    This is a container hosting a mini-app to perform matrix multiplication, exploiting parallelism via MPI.
    The status quo is: the two matrices are hardcoded, only 2 processes may run concurrently.